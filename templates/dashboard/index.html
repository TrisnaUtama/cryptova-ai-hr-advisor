{% extends "base_sidebar.html" %}
{% block title %}
  Admin Dashboard
{% endblock title %}
<!-- Dashboard Overview -->
{% block sidebar_content %}
  <style>
    .tab-btn.active {
      background-color: #fff !important;
      box-shadow: 0 2px 8px 0 rgba(37,99,235,0.08);
      font-weight: 600;
    }
    .tab-btn:hover:not(.active) {
      background-color: #e5e7eb;
      cursor: pointer;
    }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
  </style>
  <div class="dashboard-overview">
    <h1 class="text-2xl font-bold text-gray-900 mb-4">Admin Dashboard</h1>
    <p class="text-gray-500 mb-2">System Overview</p>
    <div class="flex space-x-2 mb-4">
      <button class="tab-btn px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-700 active"
              data-tab="overview">Overview</button>
      <button class="tab-btn px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-700"
              data-tab="parsing">Parsing Errors</button>
      <button class="tab-btn px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-700"
              data-tab="scoring">Scoring Weights</button>
      <button class="tab-btn px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-700"
              data-tab="candidates">Top Candidates</button>
    </div>
    <div id="tab-overview" class="tab-content active">
      <div class="grid grid-cols-4 gap-4 mb-6">
        {% include "./overview_card.html" with title="Total CVs" value="1,284" subtitle="+24 from yesterday" %}
        {% include "./overview_card.html" with title="Avg. Score" value="82.5" subtitle="+1.2 from last week" %}
        {% include "./overview_card.html" with title="High Scorers" value="87" subtitle="Score > 90" %}
        {% include "./overview_card.html" with title="Processing Rate" value="99.2%" subtitle="Successfully processed" %}
      </div>
      <div class="grid grid-cols-2 gap-4 mb-6">
        <div class="bg-white rounded-lg p-6 shadow">
          <h3 class="font-semibold mb-2">CV Processing</h3>
          <canvas id="cvProcessingChart" height="120"></canvas>
        </div>
        <div class="bg-white rounded-lg p-6 shadow">
          <h3 class="font-semibold mb-2">Average CV Score</h3>
          <canvas id="avgScoreChart" height="120"></canvas>
        </div>
      </div>
      <div class="bg-white rounded-lg p-6 shadow">
        <h3 class="font-semibold mb-2">CV Processing by Day</h3>
        <canvas id="cvByDayChart" height="120"></canvas>
      </div>
    </div>
    <div id="tab-parsing" class="tab-content">
      <!-- Parsing Errors content here -->
    </div>
    <div id="tab-scoring" class="tab-content">
      <!-- Scoring Weights content here -->
    </div>
    <div id="tab-candidates" class="tab-content">
      <!-- Top Candidates content here -->
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // Tab button functionality
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        document.querySelectorAll('.tab-btn').forEach(b => {
          b.classList.remove('active', 'bg-white', 'shadow-md');
          b.classList.add('bg-gray-100', 'text-gray-700');
        });
        this.classList.add('active', 'bg-white', 'shadow-md');
        this.classList.remove('bg-gray-100', 'text-gray-700');
        // Tab content
        document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
        document.getElementById('tab-' + this.dataset.tab).classList.add('active');
      });
    });

    // Chart.js hanya akan diinisialisasi jika Overview tab aktif (default)
    if (document.getElementById('tab-overview').classList.contains('active')) {
      new Chart(document.getElementById("cvProcessingChart"), {
        type: "line",
        data: {
          labels: ["05/05", "05/06", "05/07", "05/08", "05/09", "05/10", "05/11"],
          datasets: [
            {
              label: "Uploaded",
              data: [15, 22, 21, 27, 19, 17, 14],
              borderColor: "#2563eb",
              backgroundColor: "rgba(37,99,235,0.1)",
              tension: 0.4,
            },
            {
              label: "Processed",
              data: [14, 21, 20, 25, 18, 16, 13],
              borderColor: "#fbbf24",
              backgroundColor: "rgba(251,191,36,0.1)",
              tension: 0.4,
            },
          ],
        },
        options: {
          responsive: true,
          plugins: { legend: { display: true } },
          scales: { y: { beginAtZero: true } },
        },
      });

      new Chart(document.getElementById("avgScoreChart"), {
        type: "line",
        data: {
          labels: ["05/05", "05/06", "05/07", "05/08", "05/09", "05/10", "05/11"],
          datasets: [
            {
              label: "Score",
              data: [82, 80, 81, 85, 83, 84, 82],
              borderColor: "#2563eb",
              backgroundColor: "rgba(37,99,235,0.1)",
              tension: 0.4,
            },
          ],
        },
        options: {
          responsive: true,
          plugins: { legend: { display: false } },
          scales: { y: { min: 60, max: 100 } },
        },
      });

      new Chart(document.getElementById("cvByDayChart"), {
        type: "bar",
        data: {
          labels: ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"],
          datasets: [
            {
              label: "Uploads",
              data: [45, 50, 38, 65, 47, 10, 8],
              backgroundColor: "#2563eb",
            },
            {
              label: "Parsed",
              data: [44, 49, 37, 63, 46, 9, 7],
              backgroundColor: "#fbbf24",
            },
          ],
        },
        options: {
          responsive: true,
          plugins: { legend: { display: true } },
          scales: { y: { beginAtZero: true } },
        },
      });
    }
  </script>
{% endblock sidebar_content %}
